{"ast":null,"code":"import _classCallCheck from \"/Users/yiwang/DatabaseProject/Frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/yiwang/DatabaseProject/Frontend/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/yiwang/DatabaseProject/Frontend/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/yiwang/DatabaseProject/Frontend/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/yiwang/DatabaseProject/Frontend/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/yiwang/DatabaseProject/Frontend/src/containers/Favorites/Favorites.js\";\nimport React, { Component } from 'react';\n\nvar Favorites =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Favorites, _Component);\n\n  function Favorites() {\n    _classCallCheck(this, Favorites);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(Favorites).apply(this, arguments));\n  }\n\n  _createClass(Favorites, [{\n    key: \"render\",\n    value: function render() {\n      (function () {\n        /**\n         * Variables\n         */\n        var user_id = '1111';\n        var user_fullname = 'John';\n        var lng = -122.08;\n        var lat = 37.38;\n        /**\n         * Initialize major event handlers\n         */\n\n        function init() {\n          // register event listeners\n          document.querySelector('#login-btn').addEventListener('click', login);\n          document.querySelector('#nearby-btn').addEventListener('click', loadNearbyItems);\n          document.querySelector('#fav-btn').addEventListener('click', loadFavoriteItems);\n          document.querySelector('#recommend-btn').addEventListener('click', loadRecommendedItems); // validateSession();\n\n          onSessionValid({\n            \"user_id\": \"1111\",\n            \"name\": \"John Smith\",\n            \"status\": \"OK\"\n          });\n        }\n        /**\n         * Session\n         */\n\n\n        function validateSession() {\n          onSessionInvalid(); // The request parameters\n\n          var url = './login';\n          var req = JSON.stringify({}); // display loading message\n\n          showLoadingMessage('Validating session...'); // make AJAX call\n\n          ajax('GET', url, req, // session is still valid\n          function (res) {\n            var result = JSON.parse(res);\n\n            if (result.status === 'OK') {\n              onSessionValid(result);\n            }\n          });\n        }\n\n        function onSessionValid(result) {\n          user_id = result.user_id;\n          user_fullname = result.name;\n          var loginForm = document.querySelector('#login-form');\n          var itemNav = document.querySelector('#item-nav');\n          var itemList = document.querySelector('#item-list');\n          var avatar = document.querySelector('#avatar');\n          var welcomeMsg = document.querySelector('#welcome-msg');\n          var logoutBtn = document.querySelector('#logout-link');\n          welcomeMsg.innerHTML = 'Welcome, ' + user_fullname;\n          showElement(itemNav);\n          showElement(itemList);\n          showElement(avatar);\n          showElement(welcomeMsg);\n          showElement(logoutBtn, 'inline-block');\n          hideElement(loginForm);\n          initGeoLocation();\n        }\n\n        function onSessionInvalid() {\n          var loginForm = document.querySelector('#login-form');\n          var itemNav = document.querySelector('#item-nav');\n          var itemList = document.querySelector('#item-list');\n          var avatar = document.querySelector('#avatar');\n          var welcomeMsg = document.querySelector('#welcome-msg');\n          var logoutBtn = document.querySelector('#logout-link');\n          hideElement(itemNav);\n          hideElement(itemList);\n          hideElement(avatar);\n          hideElement(logoutBtn);\n          hideElement(welcomeMsg);\n          showElement(loginForm);\n        }\n\n        function hideElement(element) {\n          element.style.display = 'none';\n        }\n\n        function showElement(element, style) {\n          var displayStyle = style ? style : 'block';\n          element.style.display = displayStyle;\n        }\n\n        function initGeoLocation() {\n          if (navigator.geolocation) {\n            navigator.geolocation.getCurrentPosition(onPositionUpdated, onLoadPositionFailed, {\n              maximumAge: 60000\n            });\n            showLoadingMessage('Retrieving your location...');\n          } else {\n            onLoadPositionFailed();\n          }\n        }\n\n        function onPositionUpdated(position) {\n          lat = position.coords.latitude;\n          lng = position.coords.longitude;\n          loadNearbyItems();\n        }\n\n        function onLoadPositionFailed() {\n          console.warn('navigator.geolocation is not available');\n          getLocationFromIP();\n        }\n\n        function getLocationFromIP() {\n          // get location from http://ipinfo.io/json\n          var url = 'http://ipinfo.io/json';\n          var data = null;\n          ajax('GET', url, data, function (res) {\n            var result = JSON.parse(res);\n\n            if ('loc' in result) {\n              var loc = result.loc.split(',');\n              lat = loc[0];\n              lng = loc[1];\n            } else {\n              console.warn('Getting location by IP failed.');\n            }\n\n            loadNearbyItems();\n          });\n        } // -----------------------------------\n        // Login\n        // -----------------------------------\n\n\n        function login() {\n          var username = document.querySelector('#username').value;\n          var password = document.querySelector('#password').value;\n          password = md5(username + md5(password)); // The request parameters\n\n          var url = './login';\n          var req = JSON.stringify({\n            user_id: username,\n            password: password\n          });\n          ajax('POST', url, req, // successful callback\n          function (res) {\n            var result = JSON.parse(res); // successfully logged in\n\n            if (result.status === 'OK') {\n              onSessionValid(result);\n            }\n          }, // error\n          function () {\n            showLoginError();\n          }, true);\n        }\n\n        function showLoginError() {\n          document.querySelector('#login-error').innerHTML = 'Invalid username or password';\n        }\n\n        function clearLoginError() {\n          document.querySelector('#login-error').innerHTML = '';\n        } // -----------------------------------\n        // Helper Functions\n        // -----------------------------------\n\n        /**\n         * A helper function that makes a navigation button active\n         *\n         * @param btnId - The id of the navigation button\n         */\n\n\n        function activeBtn(btnId) {\n          var btns = document.querySelectorAll('.main-nav-btn'); // deactivate all navigation buttons\n\n          for (var i = 0; i < btns.length; i++) {\n            btns[i].className = btns[i].className.replace(/\\bactive\\b/, '');\n          } // active the one that has id = btnId\n\n\n          var btn = document.querySelector('#' + btnId);\n          btn.className += ' active';\n        }\n\n        function showLoadingMessage(msg) {\n          var itemList = document.querySelector('#item-list');\n          itemList.innerHTML = '<p class=\"notice\"><i class=\"fa fa-spinner fa-spin\"></i> ' + msg + '</p>';\n        }\n\n        function showWarningMessage(msg) {\n          var itemList = document.querySelector('#item-list');\n          itemList.innerHTML = '<p class=\"notice\"><i class=\"fa fa-exclamation-triangle\"></i> ' + msg + '</p>';\n        }\n\n        function showErrorMessage(msg) {\n          var itemList = document.querySelector('#item-list');\n          itemList.innerHTML = '<p class=\"notice\"><i class=\"fa fa-exclamation-circle\"></i> ' + msg + '</p>';\n        }\n        /**\n         * A helper function that creates a DOM element <tag options...>\n         * @param tag\n         * @param options\n         * @returns {Element}\n         */\n\n\n        function $create(tag, options) {\n          var element = document.createElement(tag);\n\n          for (var key in options) {\n            if (options.hasOwnProperty(key)) {\n              element[key] = options[key];\n            }\n          }\n\n          return element;\n        }\n        /**\n         * AJAX helper\n         *\n         * @param method - GET|POST|PUT|DELETE\n         * @param url - API end point\n         * @param data - request payload data\n         * @param successCallback - Successful callback function\n         * @param errorCallback - Error callback function\n         */\n\n\n        function ajax(method, url, data, successCallback, errorCallback) {\n          var xhr = new XMLHttpRequest();\n          xhr.open(method, url, true);\n\n          xhr.onload = function () {\n            if (xhr.status === 200) {\n              successCallback(xhr.responseText);\n            } else {\n              errorCallback();\n            }\n          };\n\n          xhr.onerror = function () {\n            console.error(\"The request couldn't be completed.\");\n            errorCallback();\n          };\n\n          if (data === null) {\n            xhr.send();\n          } else {\n            xhr.setRequestHeader(\"Content-Type\", \"application/json;charset=utf-8\");\n            xhr.send(data);\n          }\n        } // -------------------------------------\n        // AJAX call server-side APIs\n        // -------------------------------------\n\n        /**\n         * API #1 Load the nearby items API end point: [GET]\n         * /search?user_id=1111&lat=37.38&lon=-122.08\n         */\n\n\n        function loadNearbyItems() {\n          console.log('loadNearbyItems');\n          activeBtn('nearby-btn'); // The request parameters\n\n          var url = './search';\n          var params = 'user_id=' + user_id + '&lat=' + lat + '&lon=' + lng;\n          var data = null; // display loading message\n\n          showLoadingMessage('Loading nearby items...'); // make AJAX call\n\n          ajax('GET', url + '?' + params, data, // successful callback\n          function (res) {\n            var items = JSON.parse(res);\n\n            if (!items || items.length === 0) {\n              showWarningMessage('No nearby item.');\n            } else {\n              listItems(items);\n            }\n          }, // failed callback\n          function () {\n            showErrorMessage('Cannot load nearby items.');\n          });\n        }\n        /**\n         * API #2 Load favorite (or visited) items API end point: [GET]\n         * /history?user_id=1111\n         */\n\n\n        function loadFavoriteItems() {\n          activeBtn('fav-btn'); // request parameters\n\n          var url = './history';\n          var params = 'user_id=' + user_id;\n          var req = JSON.stringify({}); // display loading message\n\n          showLoadingMessage('Loading favorite items...'); // make AJAX call\n\n          ajax('GET', url + '?' + params, req, function (res) {\n            var items = JSON.parse(res);\n\n            if (!items || items.length === 0) {\n              showWarningMessage('No favorite item.');\n            } else {\n              listItems(items);\n            }\n          }, function () {\n            showErrorMessage('Cannot load favorite items.');\n          });\n        }\n        /**\n         * API #3 Load recommended items API end point: [GET]\n         * /recommendation?user_id=1111\n         */\n\n\n        function loadRecommendedItems() {\n          activeBtn('recommend-btn'); // request parameters\n\n          var url = './recommendation' + '?' + 'user_id=' + user_id + '&lat=' + lat + '&lon=' + lng;\n          var data = null; // display loading message\n\n          showLoadingMessage('Loading recommended items...'); // make AJAX call\n\n          ajax('GET', url, data, // successful callback\n          function (res) {\n            var items = JSON.parse(res);\n\n            if (!items || items.length === 0) {\n              showWarningMessage('No recommended item. Make sure you have favorites.');\n            } else {\n              listItems(items);\n            }\n          }, // failed callback\n          function () {\n            showErrorMessage('Cannot load recommended items.');\n          });\n        }\n        /**\n         * API #4 Toggle favorite (or visited) items\n         *\n         * @param item_id - The item business id\n         *\n         * API end point: [POST]/[DELETE] /history request json data: {\n         * user_id: 1111, visited: [a_list_of_business_ids] }\n         */\n\n\n        function changeFavoriteItem(item_id) {\n          // check whether this item has been visited or not\n          var li = document.querySelector('#item-' + item_id);\n          var favIcon = document.querySelector('#fav-icon-' + item_id);\n          var favorite = !(li.dataset.favorite === 'true'); // request parameters\n\n          var url = './history';\n          var req = JSON.stringify({\n            user_id: user_id,\n            favorite: [item_id]\n          });\n          var method = favorite ? 'POST' : 'DELETE';\n          ajax(method, url, req, // successful callback\n          function (res) {\n            var result = JSON.parse(res);\n\n            if (result.status === 'OK' || result.result === 'SUCCESS') {\n              li.dataset.favorite = favorite;\n              favIcon.className = favorite ? 'fa fa-heart' : 'fa fa-heart-o';\n            }\n          });\n        } // -------------------------------------\n        // Create item list\n        // -------------------------------------\n\n        /**\n         * List recommendation items base on the data received\n         *\n         * @param items - An array of item JSON objects\n         */\n\n\n        function listItems(items) {\n          var itemList = document.querySelector('#item-list');\n          itemList.innerHTML = ''; // clear current results\n\n          for (var i = 0; i < items.length; i++) {\n            addItem(itemList, items[i]);\n          }\n        }\n        /**\n         * Add a single item to the list\n         *\n         * @param itemList - The <ul id=\"item-list\"> tag (DOM container)\n         * @param item - The item data (JSON object)\n         *\n         <li class=\"item\">\n         <img alt=\"item image\" src=\"https://s3-media3.fl.yelpcdn.com/bphoto/EmBj4qlyQaGd9Q4oXEhEeQ/ms.jpg\" />\n         <div>\n         <a class=\"item-name\" href=\"#\" target=\"_blank\">Item</a>\n         <p class=\"item-category\">Vegetarian</p>\n         <div class=\"stars\">\n         <i class=\"fa fa-star\"></i>\n         <i class=\"fa fa-star\"></i>\n         <i class=\"fa fa-star\"></i>\n         </div>\n         </div>\n         <p class=\"item-address\">699 Calderon Ave<br/>Mountain View<br/> CA</p>\n         <div class=\"fav-link\">\n         <i class=\"fa fa-heart\"></i>\n         </div>\n         </li>\n         */\n\n\n        function addItem(itemList, item) {\n          var item_id = item.item_id; // create the <li> tag and specify the id and class attributes\n\n          var li = $create('li', {\n            id: 'item-' + item_id,\n            className: 'item'\n          }); // set the data attribute ex. <li data-item_id=\"G5vYZ4kxGQVCR\" data-favorite=\"true\">\n\n          li.dataset.item_id = item_id;\n          li.dataset.favorite = item.favorite; // item image\n\n          if (item.image_url) {\n            li.appendChild($create('img', {\n              src: item.image_url\n            }));\n          } else {\n            li.appendChild($create('img', {\n              src: 'https://assets-cdn.github.com/images/modules/logos_page/GitHub-Mark.png'\n            }));\n          } // section\n\n\n          var section = $create('div'); // title\n\n          var title = $create('a', {\n            className: 'item-name',\n            href: item.url,\n            target: '_blank'\n          });\n          title.innerHTML = item.name;\n          section.appendChild(title); // category\n\n          var category = $create('p', {\n            className: 'item-category'\n          });\n          category.innerHTML = 'Category: ' + item.categories.join(', ');\n          section.appendChild(category); // stars\n\n          var stars = $create('div', {\n            className: 'stars'\n          });\n\n          for (var i = 0; i < item.rating; i++) {\n            var star = $create('i', {\n              className: 'fa fa-star'\n            });\n            stars.appendChild(star);\n          }\n\n          if (('' + item.rating).match(/\\.5$/)) {\n            stars.appendChild($create('i', {\n              className: 'fa fa-star-half-o'\n            }));\n          }\n\n          section.appendChild(stars);\n          li.appendChild(section); // address\n\n          var address = $create('p', {\n            className: 'item-address'\n          }); // ',' => '<br/>',  '\\\"' => ''\n\n          address.innerHTML = item.address.replace(/,/g, '<br/>').replace(/\\\"/g, '');\n          li.appendChild(address); // favorite link\n\n          var favLink = $create('p', {\n            className: 'fav-link'\n          });\n\n          favLink.onclick = function () {\n            changeFavoriteItem(item_id);\n          };\n\n          favLink.appendChild($create('i', {\n            id: 'fav-icon-' + item_id,\n            className: item.favorite ? 'fa fa-heart' : 'fa fa-heart-o'\n          }));\n          li.appendChild(favLink);\n          itemList.appendChild(li);\n        }\n\n        init();\n      })();\n\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 547\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 548\n        },\n        __self: this\n      }, \"Favorites\"));\n    }\n  }]);\n\n  return Favorites;\n}(Component);\n\nexport default Favorites;","map":{"version":3,"sources":["/Users/yiwang/DatabaseProject/Frontend/src/containers/Favorites/Favorites.js"],"names":["React","Component","Favorites","user_id","user_fullname","lng","lat","init","document","querySelector","addEventListener","login","loadNearbyItems","loadFavoriteItems","loadRecommendedItems","onSessionValid","validateSession","onSessionInvalid","url","req","JSON","stringify","showLoadingMessage","ajax","res","result","parse","status","name","loginForm","itemNav","itemList","avatar","welcomeMsg","logoutBtn","innerHTML","showElement","hideElement","initGeoLocation","element","style","display","displayStyle","navigator","geolocation","getCurrentPosition","onPositionUpdated","onLoadPositionFailed","maximumAge","position","coords","latitude","longitude","console","warn","getLocationFromIP","data","loc","split","username","value","password","md5","showLoginError","clearLoginError","activeBtn","btnId","btns","querySelectorAll","i","length","className","replace","btn","msg","showWarningMessage","showErrorMessage","$create","tag","options","createElement","key","hasOwnProperty","method","successCallback","errorCallback","xhr","XMLHttpRequest","open","onload","responseText","onerror","error","send","setRequestHeader","log","params","items","listItems","changeFavoriteItem","item_id","li","favIcon","favorite","dataset","addItem","item","id","image_url","appendChild","src","section","title","href","target","category","categories","join","stars","rating","star","match","address","favLink","onclick"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\n\nclass Favorites extends Component{\n    render(){\n\n        (function() {\n\n            /**\n             * Variables\n             */\n            var user_id = '1111';\n            var user_fullname = 'John';\n            var lng = -122.08;\n            var lat = 37.38;\n          \n            /**\n             * Initialize major event handlers\n             */\n            function init() {\n              // register event listeners\n              document.querySelector('#login-btn').addEventListener('click', login);\n              document.querySelector('#nearby-btn').addEventListener('click', loadNearbyItems);\n              document.querySelector('#fav-btn').addEventListener('click', loadFavoriteItems);\n              document.querySelector('#recommend-btn').addEventListener('click', loadRecommendedItems);\n              // validateSession();\n              onSessionValid({\"user_id\":\"1111\",\"name\":\"John Smith\",\"status\":\"OK\"});\n            }\n          \n            /**\n             * Session\n             */\n            function validateSession() {\n              onSessionInvalid();\n              // The request parameters\n              var url = './login';\n              var req = JSON.stringify({});\n          \n              // display loading message\n              showLoadingMessage('Validating session...');\n          \n              // make AJAX call\n              ajax('GET', url, req,\n                // session is still valid\n                function(res) {\n                  var result = JSON.parse(res);\n          \n                  if (result.status === 'OK') {\n                    onSessionValid(result);\n                  }\n                });\n            }\n          \n            function onSessionValid(result) {\n              user_id = result.user_id;\n              user_fullname = result.name;\n          \n              var loginForm = document.querySelector('#login-form');\n              var itemNav = document.querySelector('#item-nav');\n              var itemList = document.querySelector('#item-list');\n              var avatar = document.querySelector('#avatar');\n              var welcomeMsg = document.querySelector('#welcome-msg');\n              var logoutBtn = document.querySelector('#logout-link');\n          \n              welcomeMsg.innerHTML = 'Welcome, ' + user_fullname;\n          \n              showElement(itemNav);\n              showElement(itemList);\n              showElement(avatar);\n              showElement(welcomeMsg);\n              showElement(logoutBtn, 'inline-block');\n              hideElement(loginForm);\n          \n              initGeoLocation();\n            }\n          \n            function onSessionInvalid() {\n              var loginForm = document.querySelector('#login-form');\n              var itemNav = document.querySelector('#item-nav');\n              var itemList = document.querySelector('#item-list');\n              var avatar = document.querySelector('#avatar');\n              var welcomeMsg = document.querySelector('#welcome-msg');\n              var logoutBtn = document.querySelector('#logout-link');\n          \n              hideElement(itemNav);\n              hideElement(itemList);\n              hideElement(avatar);\n              hideElement(logoutBtn);\n              hideElement(welcomeMsg);\n          \n              showElement(loginForm);\n            }\n          \n            function hideElement(element) {\n              element.style.display = 'none';\n            }\n          \n            function showElement(element, style) {\n              var displayStyle = style ? style : 'block';\n              element.style.display = displayStyle;\n            }\n          \n            function initGeoLocation() {\n              if (navigator.geolocation) {\n                navigator.geolocation.getCurrentPosition(\n                  onPositionUpdated,\n                  onLoadPositionFailed, {\n                    maximumAge: 60000\n                  });\n                showLoadingMessage('Retrieving your location...');\n              } else {\n                onLoadPositionFailed();\n              }\n            }\n          \n            function onPositionUpdated(position) {\n              lat = position.coords.latitude;\n              lng = position.coords.longitude;\n          \n              loadNearbyItems();\n            }\n          \n            function onLoadPositionFailed() {\n              console.warn('navigator.geolocation is not available');\n              getLocationFromIP();\n            }\n          \n            function getLocationFromIP() {\n              // get location from http://ipinfo.io/json\n              var url = 'http://ipinfo.io/json'\n              var data = null;\n          \n              ajax('GET', url, data, function(res) {\n                var result = JSON.parse(res);\n                if ('loc' in result) {\n                  var loc = result.loc.split(',');\n                  lat = loc[0];\n                  lng = loc[1];\n                } else {\n                  console.warn('Getting location by IP failed.');\n                }\n                loadNearbyItems();\n              });\n            }\n          \n            // -----------------------------------\n            // Login\n            // -----------------------------------\n          \n            function login() {\n              var username = document.querySelector('#username').value;\n              var password = document.querySelector('#password').value;\n              password = md5(username + md5(password));\n          \n              // The request parameters\n              var url = './login';\n              var req = JSON.stringify({\n                user_id : username,\n                password : password,\n              });\n          \n              ajax('POST', url, req,\n                // successful callback\n                function(res) {\n                  var result = JSON.parse(res);\n          \n                  // successfully logged in\n                  if (result.status === 'OK') {\n                    onSessionValid(result);\n                  }\n                },\n          \n                // error\n                function() {\n                  showLoginError();\n                },\n                true);\n            }\n          \n            function showLoginError() {\n              document.querySelector('#login-error').innerHTML = 'Invalid username or password';\n            }\n          \n            function clearLoginError() {\n              document.querySelector('#login-error').innerHTML = '';\n            }\n          \n          \n            // -----------------------------------\n            // Helper Functions\n            // -----------------------------------\n          \n            /**\n             * A helper function that makes a navigation button active\n             *\n             * @param btnId - The id of the navigation button\n             */\n            function activeBtn(btnId) {\n              var btns = document.querySelectorAll('.main-nav-btn');\n          \n              // deactivate all navigation buttons\n              for (var i = 0; i < btns.length; i++) {\n                btns[i].className = btns[i].className.replace(/\\bactive\\b/, '');\n              }\n          \n              // active the one that has id = btnId\n              var btn = document.querySelector('#' + btnId);\n              btn.className += ' active';\n            }\n          \n            function showLoadingMessage(msg) {\n              var itemList = document.querySelector('#item-list');\n              itemList.innerHTML = '<p class=\"notice\"><i class=\"fa fa-spinner fa-spin\"></i> ' +\n                msg + '</p>';\n            }\n          \n            function showWarningMessage(msg) {\n              var itemList = document.querySelector('#item-list');\n              itemList.innerHTML = '<p class=\"notice\"><i class=\"fa fa-exclamation-triangle\"></i> ' +\n                msg + '</p>';\n            }\n          \n            function showErrorMessage(msg) {\n              var itemList = document.querySelector('#item-list');\n              itemList.innerHTML = '<p class=\"notice\"><i class=\"fa fa-exclamation-circle\"></i> ' +\n                msg + '</p>';\n            }\n          \n            /**\n             * A helper function that creates a DOM element <tag options...>\n             * @param tag\n             * @param options\n             * @returns {Element}\n             */\n            function $create(tag, options) {\n              var element = document.createElement(tag);\n              for (var key in options) {\n                if (options.hasOwnProperty(key)) {\n                  element[key] = options[key];\n                }\n              }\n              return element;\n            }\n          \n            /**\n             * AJAX helper\n             *\n             * @param method - GET|POST|PUT|DELETE\n             * @param url - API end point\n             * @param data - request payload data\n             * @param successCallback - Successful callback function\n             * @param errorCallback - Error callback function\n             */\n            function ajax(method, url, data, successCallback, errorCallback) {\n              var xhr = new XMLHttpRequest();\n          \n              xhr.open(method, url, true);\n          \n              xhr.onload = function() {\n                if (xhr.status === 200) {\n                  successCallback(xhr.responseText);\n                } else {\n                  errorCallback();\n                }\n              };\n          \n              xhr.onerror = function() {\n                console.error(\"The request couldn't be completed.\");\n                errorCallback();\n              };\n          \n              if (data === null) {\n                xhr.send();\n              } else {\n                xhr.setRequestHeader(\"Content-Type\",\n                  \"application/json;charset=utf-8\");\n                xhr.send(data);\n              }\n            }\n          \n            // -------------------------------------\n            // AJAX call server-side APIs\n            // -------------------------------------\n          \n            /**\n             * API #1 Load the nearby items API end point: [GET]\n             * /search?user_id=1111&lat=37.38&lon=-122.08\n             */\n            function loadNearbyItems() {\n              console.log('loadNearbyItems');\n              activeBtn('nearby-btn');\n          \n              // The request parameters\n              var url = './search';\n              var params = 'user_id=' + user_id + '&lat=' + lat + '&lon=' + lng;\n              var data = null;\n          \n              // display loading message\n              showLoadingMessage('Loading nearby items...');\n          \n              // make AJAX call\n              ajax('GET', url + '?' + params, data,\n                // successful callback\n                function(res) {\n                  var items = JSON.parse(res);\n                  if (!items || items.length === 0) {\n                    showWarningMessage('No nearby item.');\n                  } else {\n                    listItems(items);\n                  }\n                },\n                // failed callback\n                function() {\n                  showErrorMessage('Cannot load nearby items.');\n                }\n              );\n            }\n          \n            /**\n             * API #2 Load favorite (or visited) items API end point: [GET]\n             * /history?user_id=1111\n             */\n            function loadFavoriteItems() {\n              activeBtn('fav-btn');\n          \n              // request parameters\n              var url = './history';\n              var params = 'user_id=' + user_id;\n              var req = JSON.stringify({});\n          \n              // display loading message\n              showLoadingMessage('Loading favorite items...');\n          \n              // make AJAX call\n              ajax('GET', url + '?' + params, req, function(res) {\n                var items = JSON.parse(res);\n                if (!items || items.length === 0) {\n                  showWarningMessage('No favorite item.');\n                } else {\n                  listItems(items);\n                }\n              }, function() {\n                showErrorMessage('Cannot load favorite items.');\n              });\n            }\n          \n            /**\n             * API #3 Load recommended items API end point: [GET]\n             * /recommendation?user_id=1111\n             */\n            function loadRecommendedItems() {\n              activeBtn('recommend-btn');\n          \n              // request parameters\n              var url = './recommendation' + '?' + 'user_id=' + user_id + '&lat=' + lat + '&lon=' + lng;\n              var data = null;\n          \n              // display loading message\n              showLoadingMessage('Loading recommended items...');\n          \n              // make AJAX call\n              ajax('GET', url, data,\n                // successful callback\n                function(res) {\n                  var items = JSON.parse(res);\n                  if (!items || items.length === 0) {\n                    showWarningMessage('No recommended item. Make sure you have favorites.');\n                  } else {\n                    listItems(items);\n                  }\n                },\n                // failed callback\n                function() {\n                  showErrorMessage('Cannot load recommended items.');\n                }\n              );\n            }\n          \n            /**\n             * API #4 Toggle favorite (or visited) items\n             *\n             * @param item_id - The item business id\n             *\n             * API end point: [POST]/[DELETE] /history request json data: {\n             * user_id: 1111, visited: [a_list_of_business_ids] }\n             */\n            function changeFavoriteItem(item_id) {\n              // check whether this item has been visited or not\n              var li = document.querySelector('#item-' + item_id);\n              var favIcon = document.querySelector('#fav-icon-' + item_id);\n              var favorite = !(li.dataset.favorite === 'true');\n          \n              // request parameters\n              var url = './history';\n              var req = JSON.stringify({\n                user_id: user_id,\n                favorite: [item_id]\n              });\n              var method = favorite ? 'POST' : 'DELETE';\n          \n              ajax(method, url, req,\n                // successful callback\n                function(res) {\n                  var result = JSON.parse(res);\n                  if (result.status === 'OK' || result.result === 'SUCCESS') {\n                    li.dataset.favorite = favorite;\n                    favIcon.className = favorite ? 'fa fa-heart' : 'fa fa-heart-o';\n                  }\n                });\n            }\n          \n            // -------------------------------------\n            // Create item list\n            // -------------------------------------\n          \n            /**\n             * List recommendation items base on the data received\n             *\n             * @param items - An array of item JSON objects\n             */\n            function listItems(items) {\n              var itemList = document.querySelector('#item-list');\n              itemList.innerHTML = ''; // clear current results\n          \n              for (var i = 0; i < items.length; i++) {\n                addItem(itemList, items[i]);\n              }\n            }\n          \n            /**\n             * Add a single item to the list\n             *\n             * @param itemList - The <ul id=\"item-list\"> tag (DOM container)\n             * @param item - The item data (JSON object)\n             *\n             <li class=\"item\">\n             <img alt=\"item image\" src=\"https://s3-media3.fl.yelpcdn.com/bphoto/EmBj4qlyQaGd9Q4oXEhEeQ/ms.jpg\" />\n             <div>\n             <a class=\"item-name\" href=\"#\" target=\"_blank\">Item</a>\n             <p class=\"item-category\">Vegetarian</p>\n             <div class=\"stars\">\n             <i class=\"fa fa-star\"></i>\n             <i class=\"fa fa-star\"></i>\n             <i class=\"fa fa-star\"></i>\n             </div>\n             </div>\n             <p class=\"item-address\">699 Calderon Ave<br/>Mountain View<br/> CA</p>\n             <div class=\"fav-link\">\n             <i class=\"fa fa-heart\"></i>\n             </div>\n             </li>\n             */\n            function addItem(itemList, item) {\n              var item_id = item.item_id;\n          \n              // create the <li> tag and specify the id and class attributes\n              var li = $create('li', {\n                id: 'item-' + item_id,\n                className: 'item'\n              });\n          \n              // set the data attribute ex. <li data-item_id=\"G5vYZ4kxGQVCR\" data-favorite=\"true\">\n              li.dataset.item_id = item_id;\n              li.dataset.favorite = item.favorite;\n          \n              // item image\n              if (item.image_url) {\n                li.appendChild($create('img', { src: item.image_url }));\n              } else {\n                li.appendChild($create('img', {\n                  src: 'https://assets-cdn.github.com/images/modules/logos_page/GitHub-Mark.png'\n                }));\n              }\n              // section\n              var section = $create('div');\n          \n              // title\n              var title = $create('a', {\n                className: 'item-name',\n                href: item.url,\n                target: '_blank'\n              });\n              title.innerHTML = item.name;\n              section.appendChild(title);\n          \n              // category\n              var category = $create('p', {\n                className: 'item-category'\n              });\n              category.innerHTML = 'Category: ' + item.categories.join(', ');\n              section.appendChild(category);\n          \n              // stars\n              var stars = $create('div', {\n                className: 'stars'\n              });\n          \n              for (var i = 0; i < item.rating; i++) {\n                var star = $create('i', {\n                  className: 'fa fa-star'\n                });\n                stars.appendChild(star);\n              }\n          \n              if (('' + item.rating).match(/\\.5$/)) {\n                stars.appendChild($create('i', {\n                  className: 'fa fa-star-half-o'\n                }));\n              }\n          \n              section.appendChild(stars);\n          \n              li.appendChild(section);\n          \n              // address\n              var address = $create('p', {\n                className: 'item-address'\n              });\n          \n              // ',' => '<br/>',  '\\\"' => ''\n              address.innerHTML = item.address.replace(/,/g, '<br/>').replace(/\\\"/g, '');\n              li.appendChild(address);\n          \n              // favorite link\n              var favLink = $create('p', {\n                className: 'fav-link'\n              });\n          \n              favLink.onclick = function() {\n                changeFavoriteItem(item_id);\n              };\n          \n              favLink.appendChild($create('i', {\n                id: 'fav-icon-' + item_id,\n                className: item.favorite ? 'fa fa-heart' : 'fa fa-heart-o'\n              }));\n          \n              li.appendChild(favLink);\n              itemList.appendChild(li);\n            }\n          \n            init();\n          \n          })();\n          \n\n        return (\n            <div>\n                <h1>Favorites</h1>\n            </div>\n        );\n    }   \n}\n\nexport default Favorites;"]},"metadata":{},"sourceType":"module"}